{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>查询结果</h1>
    <a href="{{ url_for('index') }}?{{ redirect_params|safe }}" class="btn btn-secondary">返回并编辑查询</a>
</div>

{% if error %}
<div class="alert alert-danger" role="alert">
  <strong>错误:</strong> {{ error }}
</div>
{% else %}

{# --- 核心修改：使用 Accordion 组件 --- #}
<div class="accordion mb-4" id="configAccordion">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
        <strong>点击查看本次查询使用的 YAML 配置</strong>
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#configAccordion">
      <div class="accordion-body">
        <pre><code class="language-yaml">{{ config }}</code></pre>
      </div>
    </div>
  </div>
</div>
{# --- 修改结束 --- #}

{% if oiers %}
    <p>共找到 {{ oiers|length }} 名符合条件的 OIer。</p>
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>UID</th>
                <th>姓名</th>
                <th>性别</th>
                <th>入学年份</th>
                <th>DB评分</th>
                <th>CCF评分</th>
                <th>CCF等级</th>
            </tr>
        </thead>
        <tbody>
        {% for oier in oiers %}
            <tr>
                <td>{{ oier.uid }}</td>
                <td>{{ oier.name }}</td>
                <td>{{ {1: '男', -1: '女', 0: '未知'}.get(oier.gender, '?') }}</td>
                <td>{{ oier.enroll_middle }}</td>
                <td>{{ "%.2f"|format(oier.oierdb_score) }}</td>
                <td>{{ "%.2f"|format(oier.ccf_score) }}</td>
                <td>{{ oier.ccf_level }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="alert alert-warning" role="alert">
        未找到符合所有条件的 OIer。
    </div>
{% endif %}
{% endif %}
{% endblock %}